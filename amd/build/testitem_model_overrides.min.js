define("local_catquiz/testitem_model_overrides",["exports","core_form/dynamicform"],(function(_exports,_dynamicform){var obj;
/*
   * @package    local_catquiz
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_dynamicform=(obj=_dynamicform)&&obj.__esModule?obj:{default:obj};const SELECTORS_FORMCONTAINER="#lcq_model_override_form",SELECTORS_NOEDITBUTTON='[name="noedititemparams"]',SELECTORS_MODELSTATUSSELECTS='#lcq_model_override_form .custom-select[name^="override_"]',SELECTORS_ACTIVEMODELSELECT='[name="active_model"]',SELECTORS_TEMP_FIELDS_INPUT='[name="temporaryfields"]',disabledStates=["0","-5"],syncSelectedState=model=>{const selected=model.value,selectorModel=model.id.match(/id_override_(.*)_select/)[1];let optionUpdateFun=option=>option.removeAttribute("disabled");disabledStates.includes(selected)&&(optionUpdateFun=option=>option.setAttribute("disabled","disabled"));document.querySelector(SELECTORS_ACTIVEMODELSELECT).options.forEach((o=>{o.value!=selectorModel||optionUpdateFun(o)}))};_exports.init=()=>{const dynamicForm=new _dynamicform.default(document.querySelector(SELECTORS_FORMCONTAINER),"local_catquiz\\form\\item_model_override_selector"),switchEditMode=targetModeIsEditing=>{console.log(`Switching edit mode to: ${targetModeIsEditing}`);const searchParams=new URLSearchParams(window.location.search);dynamicForm.load({editing:targetModeIsEditing,testitemid:searchParams.get("id"),contextid:searchParams.get("contextid"),scaleid:searchParams.get("scaleid"),component:searchParams.get("component"),updateitem:!0}).then((result=>(document.querySelectorAll(SELECTORS_MODELSTATUSSELECTS).forEach((model=>{syncSelectedState(model),model.addEventListener("change",(e=>syncSelectedState(e.target)))})),result))).catch((err=>err))};dynamicForm.addEventListener(dynamicForm.events.SUBMIT_BUTTON_PRESSED,(e=>{console.log("Submit button pressed");document.querySelector(SELECTORS_TEMP_FIELDS_INPUT).value=JSON.stringify({grm:{difficulty_x:1.2,fraction_x:3.4}})})),dynamicForm.addEventListener(dynamicForm.events.FORM_SUBMITTED,(e=>{console.log("Form submitted"),e.preventDefault();let formcontainer=document.querySelector(SELECTORS_FORMCONTAINER);const searchParams=new URLSearchParams(window.location.search);dynamicForm.load({editing:!formcontainer.querySelector(SELECTORS_NOEDITBUTTON),testitemid:searchParams.get("id"),contextid:searchParams.get("contextid"),scaleid:searchParams.get("scaleid"),component:searchParams.get("component"),updateitem:!0})})),dynamicForm.addEventListener(dynamicForm.events.NOSUBMIT_BUTTON_PRESSED,(e=>{document.querySelector(SELECTORS_FORMCONTAINER);switch(e.preventDefault(),e.detail.name){case"edititemparams":switchEditMode(!0);break;case"noedititemparams":switchEditMode(!1);break;case"override_grm[additemparams]":(e=>{new URLSearchParams(window.location.search),console.log("In add item params"),console.log(e);const lastBreak=e.detail.parentElement.parentElement.previousElementSibling,newFractionLabel=document.createElement("label");newFractionLabel.textContent="Fraction X",newFractionLabel.setAttribute("for","fraction_x");const newFractionInput=document.createElement("input");newFractionInput.className="form-control param-input",newFractionInput.id="fraction_x";const newDifficultyLabel=document.createElement("label");newDifficultyLabel.textContent="Difficulty X",newDifficultyLabel.setAttribute("for","difficulty_x");const newDifficultyInput=document.createElement("input");newDifficultyInput.className="form-control param-input",newDifficultyInput.id="difficulty_x",lastBreak.insertAdjacentElement("afterend",newDifficultyInput),lastBreak.insertAdjacentElement("afterend",newDifficultyLabel),lastBreak.insertAdjacentElement("afterend",newFractionInput),lastBreak.insertAdjacentElement("afterend",newFractionLabel);const tempFieldsInput=document.querySelector(SELECTORS_TEMP_FIELDS_INPUT);let tempids=JSON.parse(tempFieldsInput.value);tempids.push("difficulty_x"),tempids.push("fraction_x"),tempFieldsInput.value=JSON.stringify(tempids)})(e);break;default:console.log(`Unknown no-submit action: ${e.detail.name}`)}}))}}));

//# sourceMappingURL=testitem_model_overrides.min.js.map