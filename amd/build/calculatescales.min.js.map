{"version":3,"file":"calculatescales.min.js","sources":["../src/calculatescales.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_catquiz\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\n\nconst SELECTORS = {\n    FORMCONTAINER: '#lcq_select_context_form',\n    CALCULATEBUTTON: '#model_button'\n};\n/**\n * Add event listener to buttons.\n */\nexport const init = () => {\n\n    const calculateButton = document.querySelector(SELECTORS.CALCULATEBUTTON);\n    if (!calculateButton) {\n        return;\n    }\n    const contextId = parseInt(calculateButton.dataset.contextid);\n    calculateButton.onclick = () => {\n        updateParameters(contextId);\n    };\n\n    const updateParameters = async(contextid) => {\n        const urlParams = new URLSearchParams(window.location.search);\n        const catscaleid = urlParams.get('scaleid');\n\n        // Fallback if the translation can not be loaded\n        let errorMessage = 'Something went wrong';\n        try {\n            errorMessage = await getString('somethingwentwrong', 'local_catquiz');\n        } catch (error) {\n            // We already have a fallback message, nothing to do here.\n        }\n        Ajax.call([{\n            methodname: 'local_catquiz_update_parameters',\n            args: {contextid, catscaleid},\n            done: async function(res) {\n                if (res.success) {\n                    disableButton();\n                    // Fallback if the translation can not be loaded\n                    let successMessage = 'Recalculation was scheduled';\n                    try {\n                        successMessage = await getString('recalculationscheduled', 'local_catquiz');\n                    } catch (error) {\n                        // We already have a fallback message, nothing to do here.\n                    }\n\n                    Notification.addNotification({\n                        message: successMessage,\n                        type: 'success'\n                    });\n                } else {\n                    disableButton();\n                    Notification.addNotification({\n                        message: errorMessage,\n                        type: 'danger'\n                    });\n                }\n            },\n            fail: () => {\n                    disableButton();\n                    Notification.addNotification({\n                        message: errorMessage,\n                        type: 'danger'\n                    });\n            },\n        }]);\n    };\n\n    const disableButton = () => {\n        document.querySelector(SELECTORS.CALCULATEBUTTON).setAttribute('disabled', true);\n    };\n};\n"],"names":["SELECTORS","calculateButton","document","querySelector","contextId","parseInt","dataset","contextid","onclick","updateParameters","async","catscaleid","URLSearchParams","window","location","search","get","errorMessage","error","call","methodname","args","done","res","success","disableButton","successMessage","addNotification","message","type","fail","setAttribute"],"mappings":";;;;;gLAyBMA,0BAEe,8BAKD,WAEVC,gBAAkBC,SAASC,cAAcH,+BAC1CC,6BAGCG,UAAYC,SAASJ,gBAAgBK,QAAQC,WACnDN,gBAAgBO,QAAU,KACtBC,iBAAiBL,kBAGfK,iBAAmBC,MAAAA,kBAEfC,WADY,IAAIC,gBAAgBC,OAAOC,SAASC,QACzBC,IAAI,eAG7BC,aAAe,2BAEfA,mBAAqB,mBAAU,qBAAsB,iBACvD,MAAOC,sBAGJC,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,CAACd,UAAAA,UAAWI,WAAAA,YAClBW,KAAMZ,eAAea,QACbA,IAAIC,QAAS,CACbC,oBAEIC,eAAiB,kCAEjBA,qBAAuB,mBAAU,yBAA0B,iBAC7D,MAAOR,8BAIIS,gBAAgB,CACzBC,QAASF,eACTG,KAAM,iBAGVJ,sCACaE,gBAAgB,CACzBC,QAASX,aACTY,KAAM,YAIlBC,KAAM,KACEL,sCACaE,gBAAgB,CACzBC,QAASX,aACTY,KAAM,gBAMpBJ,cAAgB,KAClBvB,SAASC,cAAcH,2BAA2B+B,aAAa,YAAY"}