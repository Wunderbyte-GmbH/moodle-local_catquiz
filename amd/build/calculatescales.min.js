define("local_catquiz/calculatescales",["exports","core/str","core/ajax","core_form/dynamicform","core/notification"],(function(_exports,_str,_ajax,_dynamicform,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * @package    local_catquiz
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_dynamicform=_interopRequireDefault(_dynamicform),_notification=_interopRequireDefault(_notification);const SELECTORS_FORMCONTAINER="#lcq_select_context_form",SELECTORS_CALCULATEBUTTON="#model_button";_exports.init=()=>{const dynamicForm=new _dynamicform.default(document.querySelector(SELECTORS_FORMCONTAINER),"local_catquiz\\form\\contextselector"),calculateButton=document.querySelector(SELECTORS_CALCULATEBUTTON),contextId=parseInt(calculateButton.dataset.contextid);calculateButton.onclick=()=>{updateParameters(contextId)},dynamicForm.addEventListener(dynamicForm.events.FORM_SUBMITTED,(e=>{e.preventDefault();const response=e.detail;if(!response.contextid)return;let searchParams=new URLSearchParams(window.location.search);searchParams.set("contextid",response.contextid),window.location.search=searchParams.toString()})),dynamicForm.addEventListener("change",(e=>{e.preventDefault(),setTimeout((()=>{dynamicForm.submitFormAjax()}),500)}));const updateParameters=async contextid=>{const catscaleid=new URLSearchParams(window.location.search).get("scaleid");let errorMessage="Something went wrong";try{errorMessage=await(0,_str.get_string)("somethingwentwrong","local_catquiz")}catch(error){}_ajax.default.call([{methodname:"local_catquiz_update_parameters",args:{contextid:contextid,catscaleid:catscaleid},done:async function(res){if(res.success){disableButton();let successMessage="Recalculation was scheduled";try{successMessage=await(0,_str.get_string)("recalculationscheduled","local_catquiz")}catch(error){}_notification.default.addNotification({message:successMessage,type:"success"})}else disableButton(),_notification.default.addNotification({message:errorMessage,type:"danger"})},fail:()=>{disableButton(),_notification.default.addNotification({message:errorMessage,type:"danger"})}}])},disableButton=()=>{document.querySelector(SELECTORS_CALCULATEBUTTON).setAttribute("disabled",!0)}}}));

//# sourceMappingURL=calculatescales.min.js.map