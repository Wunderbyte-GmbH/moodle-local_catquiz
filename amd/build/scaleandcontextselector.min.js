define("local_catquiz/scaleandcontextselector",["exports","core_form/dynamicform"],(function(_exports,_dynamicform){var obj;
/*
   * @package    local_catquiz
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_exports.listenToSelect=listenToSelect,_dynamicform=(obj=_dynamicform)&&obj.__esModule?obj:{default:obj};const SELECTORS_CONTEXTFORM="div[id='lcq_select_context_form']",SELECTORS_CHECKBOXSELECTOR="input.integrate-subscales-checkbox",SELECTORS_SCALECONTAINER="[id='catmanagerquestions-scaleselectors']",SELECTORS_SELECTS='[id*="select_scale_form_scaleid"]',SELECTORS_CONTAINERCLASSSELECTOR=".catscales-dashboard";function listenToSelect(element,location,paramname){const dynamicForm=new _dynamicform.default(element,location);dynamicForm.addEventListener(dynamicForm.events.FORM_SUBMITTED,(e=>{if(!dynamicForm)return;const response=e.detail;let searchParams=new URLSearchParams(window.location.search);if("scaleid"==paramname&&"-1"==response[paramname]){let scaleid=function(element){var selectcontainer=element.closest(SELECTORS_SCALECONTAINER),selects=selectcontainer.querySelectorAll(SELECTORS_SELECTS);let last;const select=element.closest(SELECTORS_SELECTS);let keepdeletinglastnode=!0;for(;keepdeletinglastnode;)(selects=selectcontainer.querySelectorAll(SELECTORS_SELECTS)).length>1?(last=selects[selects.length-1],last==select&&(keepdeletinglastnode=!1),last.remove()):keepdeletinglastnode=!1;selects=selectcontainer.querySelectorAll(SELECTORS_SELECTS),last=selects[selects.length-1];return last.querySelector('[name="scaleid"]').value}(element);searchParams.set(paramname,scaleid)}else searchParams.set(paramname,response[paramname]);searchParams.delete("contextid"),window.location.search=searchParams.toString()})),dynamicForm.addEventListener("change",(e=>{e.preventDefault(),setTimeout((()=>{dynamicForm&&dynamicForm.submitFormAjax()}),100)}))}_exports.init=()=>{document.querySelectorAll(SELECTORS_CONTAINERCLASSSELECTOR).forEach((container=>{!function(container){var checkbox=container.querySelector(SELECTORS_CHECKBOXSELECTOR);checkbox&&checkbox.addEventListener("click",(e=>{let searchParams=new URLSearchParams(window.location.search);!0===checkbox.checked?(searchParams.set("usesubs",1),window.location.search=searchParams.toString()):(searchParams.set("usesubs",0),window.location.search=searchParams.toString())}));document.querySelectorAll(SELECTORS_CONTEXTFORM).forEach((contextcontainer=>{if(contextcontainer){var contextselector=contextcontainer.querySelector("select");contextselector&&contextselector.addEventListener("change",(function(){let searchParams=new URLSearchParams(window.location.search);searchParams.set("contextid",contextselector.value),window.location.search=searchParams.toString()}))}}));const selectcontainer=container.querySelector(SELECTORS_SCALECONTAINER);if(selectcontainer){var selects=selectcontainer.querySelectorAll(SELECTORS_SELECTS);selects&&selects.forEach((select=>{listenToSelect(select,"local_catquiz\\form\\scaleselector","scaleid")}))}}(container)}))}}));

//# sourceMappingURL=scaleandcontextselector.min.js.map